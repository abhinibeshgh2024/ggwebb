<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webb | NetSpeedTest</title>
    <style>
        :root {
            --primary: #38bdf8;
            --bg: #0b0f1a;
            --card-bg: rgba(255, 255, 255, 0.03);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        body {
            min-height: 100vh;
            background: var(--bg);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 50px;
        }

        /* HEADER */
        header { text-align: center; margin-bottom: 30px; }
        .logo-img {
            width: 130px;
            height: auto;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px rgba(56, 189, 248, 0.4));
        }

        /* METER BOX */
        .meter-box {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
        }

        .scanner {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.05);
        }

        /* Active Spinning Animation */
        .testing .scanner {
            border-top: 4px solid var(--primary);
            border-right: 4px solid transparent;
            animation: spin 0.6s linear infinite;
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.3);
        }

        .pulse {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(56, 189, 248, 0.15) 0%, transparent 70%);
            display: none;
        }

        .testing .pulse { display: block; animation: pulse-ring 1.2s ease-out infinite; }

        .speed-text { text-align: center; z-index: 10; }
        #speed { 
            font-size: 80px; 
            font-weight: 900; 
            line-height: 1;
            background: linear-gradient(180deg, #fff 30%, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .unit { color: #64748b; font-weight: 600; letter-spacing: 3px; font-size: 14px; margin-top: 5px; }

        /* STATS GRID */
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
            max-width: 400px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.08);
            padding: 20px;
            border-radius: 24px;
            text-align: center;
        }

        .stat-card span { display: block; color: #64748b; font-size: 11px; text-transform: uppercase; margin-bottom: 8px; }
        .stat-card b { font-size: 22px; color: #f8fafc; }

        /* BUTTON */
        #btn {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 18px 80px;
            border-radius: 100px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: 0.4s;
        }

        #btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 40px rgba(56, 189, 248, 0.4); }
        #btn:disabled { opacity: 0.3; cursor: not-allowed; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes pulse-ring { 
            0% { transform: scale(0.7); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: scale(1.2); opacity: 0; }
        }
    </style>
</head>
<body>

<header>
    <img src="WEBB-removebg-preview.png" alt="Webb Logo" class="logo-img">
</header>

<div class="meter-box" id="meterBox">
    <div class="pulse"></div>
    <div class="scanner"></div>
    <div class="speed-text">
        <div id="speed">0</div>
        <div class="unit">Mbps</div>
    </div>
</div>

<div class="stats">
    <div class="stat-card">
        <span>Ping</span>
        <b id="ping">--</b><small style="color:#64748b"> ms</small>
    </div>
    <div class="stat-card">
        <span>Jitter</span>
        <b id="jitter">--</b><small style="color:#64748b"> ms</small>
    </div>
</div>

<button id="btn" onclick="startHeavyTest()">Start Test</button>

<script>
    const speedEl = document.getElementById('speed');
    const pingEl = document.getElementById('ping');
    const jitterEl = document.getElementById('jitter');
    const meterBox = document.getElementById('meterBox');
    const btn = document.getElementById('btn');

    let isRunning = false;

    // Numbers shuffle effect
    function shuffle() {
        if(!isRunning) return;
        speedEl.innerText = (Math.random() * 90 + 10).toFixed(1);
        setTimeout(shuffle, 70);
    }

    async function startHeavyTest() {
        isRunning = true;
        btn.disabled = true;
        btn.innerText = "Testing...";
        meterBox.classList.add('testing');
        shuffle();

        try {
            // 1. LATENCY TEST
            const pings = [];
            for(let i=0; i<5; i++) {
                const s = performance.now();
                await fetch('https://1.1.1.1/favicon.ico?t=' + Math.random(), { mode: 'no-cors' });
                pings.push(performance.now() - s);
            }
            pingEl.innerText = Math.min(...pings).toFixed(0);
            jitterEl.innerText = Math.abs(pings[2] - pings[0]).toFixed(0);

            // 2. HEAVY DOWNLOAD (Approx 25MB+)
            // Using Cloudflare's edge network for heavy data
            const heavyUrl = "https://speed.cloudflare.com/__down?bytes=25000000"; 
            
            const start = performance.now();
            const response = await fetch(heavyUrl);
            const reader = response.body.getReader();
            
            let receivedLength = 0;
            while(true) {
                const {done, value} = await reader.read();
                if (done) break;
                receivedLength += value.length;
                // Optional: Yahan real-time progress bhi dikha sakte hain
            }
            const end = performance.now();

            // Calculation
            const durationSec = (end - start) / 1000;
            const bitsLoaded = receivedLength * 8;
            const speedMbps = (bitsLoaded / durationSec / (1024 * 1024)).toFixed(2);

            // STOP ANIMATION
            isRunning = false;
            meterBox.classList.remove('testing');
            
            // Final count-up animation
            animateFinal(speedMbps);

        } catch (e) {
            console.error(e);
            isRunning = false;
            meterBox.classList.remove('testing');
            speedEl.innerText = "Error";
            btn.disabled = false;
            btn.innerText = "Try Again";
        }
    }

    function animateFinal(target) {
        let current = 0;
        const duration = 1500; // 1.5 seconds final settle
        const start = performance.now();

        function update(now) {
            const elapsed = now - start;
            const progress = Math.min(elapsed / duration, 1);
            // Ease out function
            const value = progress * (2 - progress) * target;
            
            speedEl.innerText = value.toFixed(1);

            if(progress < 1) {
                requestAnimationFrame(update);
            } else {
                speedEl.innerText = target;
                btn.disabled = false;
                btn.innerText = "Restart Test";
            }
        }
        requestAnimationFrame(update);
    }
</script>

</body>
</html>
